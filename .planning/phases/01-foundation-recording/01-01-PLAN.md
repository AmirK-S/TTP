---
phase: 01-foundation-recording
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - vite.config.ts
  - tailwind.config.js
  - src-tauri/Cargo.toml
  - src-tauri/tauri.conf.json
  - src-tauri/src/lib.rs
  - src-tauri/src/main.rs
  - src/main.tsx
  - src/App.tsx
  - .github/workflows/build.yml
autonomous: true

must_haves:
  truths:
    - "Project builds successfully with `npm run tauri build`"
    - "Development server runs with `npm run tauri dev`"
    - "CI workflow validates builds on push"
  artifacts:
    - path: "src-tauri/Cargo.toml"
      provides: "Rust dependencies including Tauri 2.x and plugins"
      contains: "tauri = { version = \"2"
    - path: "src-tauri/tauri.conf.json"
      provides: "Tauri app configuration"
      contains: "\"identifier\": \"com.ttp.app\""
    - path: "package.json"
      provides: "NPM project with Tauri scripts"
      contains: "\"tauri\": \"tauri\""
    - path: ".github/workflows/build.yml"
      provides: "CI pipeline for macOS and Windows"
      contains: "tauri-action"
  key_links:
    - from: "package.json"
      to: "src-tauri/tauri.conf.json"
      via: "npm run tauri dev invokes Tauri CLI"
      pattern: "tauri dev"
    - from: "src-tauri/Cargo.toml"
      to: "src-tauri/src/lib.rs"
      via: "Rust crate lib entry point"
      pattern: "lib\\.rs"
---

<objective>
Scaffold the Tauri 2.x project with React/TypeScript frontend, Rust backend, and CI/CD pipeline.

Purpose: Establish the foundation that all Phase 1 features build upon. Without a working build system and project structure, nothing else can proceed.

Output: Buildable Tauri app skeleton with CI/CD, ready for feature development.
</objective>

<execution_context>
@/Users/amirkellousidhoum/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amirkellousidhoum/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-recording/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Tauri 2.x project with React and TypeScript</name>
  <files>
    package.json
    tsconfig.json
    vite.config.ts
    tailwind.config.js
    src/main.tsx
    src/App.tsx
    src/index.css
    src-tauri/Cargo.toml
    src-tauri/tauri.conf.json
    src-tauri/src/lib.rs
    src-tauri/src/main.rs
    src-tauri/capabilities/default.json
  </files>
  <action>
    Run `npm create tauri-app@latest . -- --template react-ts` to scaffold project.

    After scaffolding:
    1. Update `src-tauri/Cargo.toml` to add required dependencies:
       - tauri = { version = "2", features = ["tray-icon"] }
       - tauri-plugin-global-shortcut = "2"
       - tauri-plugin-positioner = { version = "2", features = ["tray-icon"] }
       - tauri-plugin-keyring
       - serde = { version = "1", features = ["derive"] }
       - serde_json = "1"

       For macOS only (conditional compilation):
       - tauri-plugin-macos-permissions = "2" (target.'cfg(target_os = "macos")')

    2. Update `src-tauri/tauri.conf.json`:
       - Set identifier to "com.ttp.app"
       - Set productName to "TTP"
       - Configure for tray-icon capability
       - Set app windows to start hidden (tray-only app)

    3. Set up Tailwind CSS:
       - npm install -D tailwindcss postcss autoprefixer
       - npx tailwindcss init -p
       - Configure tailwind.config.js for src/**/*.{ts,tsx}
       - Add Tailwind directives to src/index.css

    4. Install frontend dependencies:
       - npm install @tauri-apps/api @tauri-apps/plugin-global-shortcut
       - npm install zustand lucide-react sonner
       - npx shadcn@latest init (accept defaults, use New York style)

    5. Update src-tauri/capabilities/default.json to include permissions for:
       - global-shortcut:allow-register
       - global-shortcut:allow-unregister
       - core:tray:default
       - positioner:default

    6. Create minimal src-tauri/src/lib.rs with plugin registration:
       - Register tauri_plugin_global_shortcut
       - Register tauri_plugin_positioner
       - Register tauri_plugin_keyring
       - Conditionally register tauri_plugin_macos_permissions on macOS

    7. Update src-tauri/src/main.rs to call lib.rs run function.

    AVOID: Do not use deprecated Tauri 1.x patterns. Use Tauri 2.x plugin system.
  </action>
  <verify>
    Run `npm run tauri dev` - app window should open (even if empty).
    Run `cargo check --manifest-path src-tauri/Cargo.toml` - no compilation errors.
  </verify>
  <done>
    - Tauri dev server runs without errors
    - Cargo check passes
    - Tailwind CSS configured
    - All plugins registered in lib.rs
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CI/CD workflow for macOS and Windows builds</name>
  <files>
    .github/workflows/build.yml
  </files>
  <action>
    Create GitHub Actions workflow at .github/workflows/build.yml:

    1. Trigger on push to main and pull requests

    2. Build matrix for:
       - macOS-latest (Intel + Apple Silicon via universal binary)
       - windows-latest

    3. Steps for each platform:
       - Checkout code
       - Setup Node.js 20.x
       - Setup Rust stable
       - Install dependencies (npm ci)
       - Run `npm run tauri build`
       - Upload artifacts

    4. Use tauri-apps/tauri-action@v0 for building:
       - This handles platform-specific build requirements
       - Produces .dmg for macOS, .msi for Windows

    5. Cache Rust dependencies and npm modules for faster builds.

    Reference: https://v2.tauri.app/distribute/pipelines/github/

    AVOID: Do not attempt cross-compilation. Each platform builds on its native runner.
  </action>
  <verify>
    - File exists at .github/workflows/build.yml
    - YAML is valid (use yq or manual inspection)
    - Workflow defines both macOS and Windows jobs
  </verify>
  <done>
    - CI workflow file created
    - Configured for macOS and Windows builds
    - Uses tauri-action for building
    - Caching configured for dependencies
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify build and create project structure</name>
  <files>
    src-tauri/icons/icon-idle.png
    src-tauri/icons/icon-recording.png
    src-tauri/sounds/.gitkeep
    src/windows/.gitkeep
    src/components/.gitkeep
    src/hooks/.gitkeep
    src/stores/.gitkeep
  </files>
  <action>
    1. Create directory structure for Phase 1 development:
       - src/windows/ (for FloatingBar, Settings windows)
       - src/components/ (for React components)
       - src/hooks/ (for custom hooks)
       - src/stores/ (for Zustand stores)
       - src-tauri/sounds/ (for audio cues)

    2. Add placeholder tray icons:
       - Create 32x32 PNG icons (can be simple placeholders)
       - icon-idle.png: Default state icon
       - icon-recording.png: Recording state icon (could be red dot or similar)
       - Use any simple icon generation method available

    3. Run full build verification:
       - npm run tauri build --debug (faster than release)
       - Verify .app (macOS) or .exe (Windows) is produced

    4. Clean up default template content:
       - Simplify App.tsx to minimal component
       - Remove template boilerplate from index.css (keep Tailwind directives)

    AVOID: Do not add complex components yet. This is scaffold verification only.
  </action>
  <verify>
    - `npm run tauri build --debug` completes successfully
    - Build output exists in src-tauri/target/debug/bundle/
    - Directory structure created
    - Placeholder icons exist
  </verify>
  <done>
    - Debug build produces runnable application
    - Directory structure ready for Phase 1 features
    - Placeholder tray icons in place
    - Clean, minimal App.tsx
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run tauri dev` launches the application
2. `npm run tauri build --debug` produces a working binary
3. `cargo check` passes without errors
4. Project structure matches RESEARCH.md recommended layout
5. CI workflow file is valid YAML with correct job definitions
</verification>

<success_criteria>
- Tauri 2.x project builds successfully on development machine
- All required plugins are installed and registered
- CI/CD workflow is configured for multi-platform builds
- Project structure is ready for feature development
- Development iteration cycle works (code change -> hot reload)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-recording/01-01-SUMMARY.md`
</output>
